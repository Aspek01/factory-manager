# D-0.1 — Tenancy Core (LOCKED)

## 1) Purpose
Factory Manager multi-tenant izolasyonunu ve scope modelini kilitlemek:
SYSTEM → COMPANY → FACILITY → SECTION → WORKSTATION

## 2) Entities
### Company
- id (UUID)
- name
- is_active
- created_at

### Facility
- id (UUID)
- company_id (FK → Company)
- name
- is_active
- created_at

### Section
- id (UUID)
- company_id (FK → Company)  **(denormalized, mandatory)**
- facility_id (FK → Facility)
- name
- is_active
- created_at

### Workstation
- id (UUID)
- company_id (FK → Company) **(denormalized, mandatory)**
- section_id (FK → Section)
- code (unique per company)
- name
- is_active
- created_at

## 3) Invariants (LOCKED)
- Cross-company access: kesin yasak.
- Her entity company_id taşır (Company hariç).
- facility.company_id = section.company_id = workstation.company_id tutarlı olmalı.
- Alt scope üst scope’u göremez (read yok).
- Üst scope alt scope’u okuyabilir (yalnız gerekli ekranlar).
- Tüm DB erişimleri company_id filtresi ile yapılır (default).

## 4) Request Context (LOCKED)
Her request’te active scope taşınır:
- active_company_id (mandatory)
- active_facility_id (optional)
- active_section_id (optional)
- active_workstation_id (optional)

Kurallar:
- active_company_id olmadan request işlenmez (403).
- facility/section/workstation set edildiyse, hepsi active_company_id ile tutarlı olmak zorunda.

## 5) Access Model (High-level)
- system_admin: SYSTEM scope, tüm şirketleri yönetebilir.
- diğer tüm roller: tek company ile bağlıdır.
- user birden fazla company’ye aynı anda bağlı olamaz (MVP locked).

## 6) Out of Scope
- Multi-company user
- Field-level permissions
- Custom role builder

## 7) Acceptance Criteria
- Bu spec kilitlenmeden tenancy kodu yazılamaz.
- Tüm tenancy entity’lerinde company_id tutarlılığı ve izolasyon kuralları açık ve test edilebilir şekilde tanımlanmıştır.
